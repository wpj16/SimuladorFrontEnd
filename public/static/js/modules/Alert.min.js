import{LOADING}from"../constants/Constants.js";import SessionStorage from"../modules/SessionStorage.min.js";class Alert{timeout=5e3;messages={};sessionkey="scl-alerts";constructor(){try{this.hiddenBackend(),this.showMessageSession()}catch(e){return alert("Um erro ocorreu ("+e+"), informe o setor de TI respons치vel!"),this}}getCountMessages(){let ref=this;return ref.messages?Object.keys(ref.messages).length:0}deleteMessage(key){let ref=this;return void 0!==ref.messages[key]&&delete ref.messages[key],ref}getMessage(key){let ref=this;return void 0!==ref.messages[key]?ref.messages[key]:null}getFirstMessage(){let ref=this;if(ref.messages&&Object.keys(ref.messages).length>0){let firstKey=Object.keys(ref.messages)[0];return ref.messages[firstKey]}return null}getFirstKeyMessage(){let ref=this;if(ref.messages&&Object.keys(ref.messages).length>0){let firstKey;return Object.keys(ref.messages)[0]}return null}generateNewId(){let ref=this,randon,timestamp,listMsgLength,newId;return(Math.random()+"-"+(new Date).getTime()+"-"+Object.keys(ref.messages).length).replace(/[^0-9\-]/g,"")}timeout(time){let ref=this;return ref.timeout=time,ref}success(message){let ref=this,id=this.generateNewId();return ref.messages[id]={id:id,text:message,type:1,class:"alert-html-success"},ref}warning(message){let ref=this,id=this.generateNewId();return ref.messages[id]={id:id,text:message,type:2,class:"alert-html-warning"},ref}error(message){let ref=this,id=this.generateNewId();return ref.messages[id]={id:id,text:message,type:3,class:"alert-html-danger"},ref}confirm(message,caseyes=null,caseno=null){let ref=this,id=this.generateNewId();return ref.messages[id]={id:id,text:message,type:4,caseyes:caseyes,caseno:caseno,class:"alert-html-warning"},ref}loading(message,timeout=0){let ref=this,id=this.generateNewId();return ref.messages[id]={id:id,text:message,type:5,class:"alert-html-warning",timeout:timeout},ref}redirect(url){let ref=this,session=new SessionStorage,datasession=btoa(JSON.stringify(ref.messages,(function(key,value){return"function"==typeof value?value.toString():value})));return session.add("scl-alerts",datasession),window.location.href=url}showMessageSession(){try{let ref=this,session=new SessionStorage,fila=session.select(ref.sessionkey);session.delete(ref.sessionkey),fila=fila?JSON.parse(atob(fila),(function(key,value){if("string"==typeof value&&0===value.toString().indexOf("function")){let functionTemplate=`(${value})`;return eval(functionTemplate)}return value})):{},ref.messages=fila,ref.show()}catch(e){return alert("Um erro ocorreu ("+e+"), informe o setor de TI respons치vel!"),this}}show(){let ref=this;try{if(ref.getCountMessages()<=0)return this;let body=$("body"),newalert=ref.html(),firstkey=ref.getFirstKeyMessage(),firstmsg=ref.getMessage(firstkey);ref.deleteMessage(firstkey);let confirm=4==firstmsg.type,loading=5==firstmsg.type;return confirm=!1,newalert=newalert.replaceAll("##alert-html-id##",firstmsg.id),newalert=newalert.replaceAll("##alert-type-class##",firstmsg.class),newalert=newalert.replaceAll("##alert-msg##",firstmsg.text),newalert=newalert.replaceAll("##hidden-close##",confirm?"hidden":""),newalert=newalert.replaceAll("##hidden-yes##",confirm?"":"hidden"),newalert=newalert.replaceAll("##hidden-no##",confirm?"":"hidden"),newalert=newalert.replaceAll("##hidden-loading##",loading?"":"hidden"),body.find("alert-html").length<=0&&body.append(' <alert-html class="col-12"></alert-html>'),body.find("alert-html").prepend(newalert),[1,2,3].indexOf(firstmsg.type)>-1&&ref.hidden("#alert-html-"+firstmsg.id,ref.timeout),body.find("alert-html").find("#alert-html-close-"+firstkey).on("click",firstmsg,(function(event){ref.hidden("#alert-html-"+event.data.id)})),body.find("alert-html").find("#alert-html-confirm-yes-"+firstkey).on("click",firstmsg,(function(event){"function"==typeof event.data.caseyes&&event.data.caseyes(ref),ref.hidden("#alert-html-"+event.data.id)})),body.find("alert-html").find("#alert-html-confirm-no-"+firstkey).on("click",firstmsg,(function(event){"function"==typeof event.data.caseno&&event.data.caseno(ref),ref.hidden("#alert-html-"+event.data.id)})),ref.getCountMessages()>0?ref.show():ref}catch(e){return alert("Um erro ocorreu ("+e+"), informe o setor de TI respons치vel!"),this}}hidden(id,timeout=0){try{setTimeout((function(){let el;($(id).is("alert-html-item")?$(id).off():$(id).off().parents("alert-html-item")).fadeOut("slow",(function(){let elAlert=$(this).parents("alert-html"),elAlertLength=elAlert.find("alert-html-item").length,elAlertIten;return $(this).remove(),elAlertLength<=1&&elAlert.remove(),!0}))}),timeout)}catch(e){alert("Um erro ocorreu, informe o setor de TI respons치vel!")}}hiddenBackend(){let ref=this,body;$("body").find("alert-html").find("alert-html-item[backend]").each((function(){let newid=ref.generateNewId();$(this).attr("id","alert-html-"+newid),ref.hidden("#alert-html-"+newid,ref.timeout),$(this).find("alert-html-close").on("click",(function(){$(this).attr("id","alert-html-close-"+newid),ref.hidden("#alert-html-close-"+newid)}))}))}html(){let htmlAlert="";return htmlAlert+='<alert-html-item id="alert-html-##alert-html-id##" data-id="##alert-html-id##" class="##alert-type-class##">',htmlAlert+='<alert-html-load  id="alert-html-load-##alert-html-id##" ##hidden-loading##>',htmlAlert+='<img width="25" height="25" src="'+LOADING+'">',htmlAlert+="</alert-html-load>",htmlAlert+="<alert-html-message>",htmlAlert+="<span>##alert-msg##<br></span>",htmlAlert+="</alert-html-message>",htmlAlert+='<alert-html-confirm-yes  id="alert-html-confirm-yes-##alert-html-id##" tabindex="1" role="button" ##hidden-yes##>',htmlAlert+="<span>Confirmar</span>",htmlAlert+="</alert-html-confirm-yes>",htmlAlert+='<alert-html-confirm-no   id="alert-html-confirm-no-##alert-html-id##" tabindex="2" role="button" ##hidden-no##>',htmlAlert+="<span>Cancelar</span>",htmlAlert+="</alert-html-confirm-no>",htmlAlert+='<alert-html-close id="alert-html-close-##alert-html-id##" tabindex="0" role="button" ##hidden-close##>',htmlAlert+="X",htmlAlert+="</alert-html-close>",htmlAlert+="</alert-html-item>",htmlAlert}}export default Alert;